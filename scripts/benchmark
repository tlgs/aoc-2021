#!/bin/bash

unset tmpdir
trap '[[ $tmpdir ]] && rm -rf "$tmpdir"' EXIT
tmpdir=$(mktemp -d)

days=$(find . -maxdepth 1 -name '??.py' -print0 | xargs -0 -I {} basename {} .py | sort | xargs | tr ' ' ',')

hyperfine \
  -w 10 \
  --export-markdown "$tmpdir/table.md" \
  -L day "$days" \
  'python {day}.py < data/{day}.txt'

cat > "$tmpdir/header.md" << EOF
# Benchmark

Autogenerated using [hyperfine](https://github.com/sharkdp/hyperfine).

These measurements **include Python's startup and module import times** which are
non-negligible for runtimes below the hundreds of milliseconds
(i.e. \`python -c pass\` takes ~14ms).
See this [Python-Dev thread](https://mail.python.org/pipermail/python-dev/2018-May/153296.html).

EOF

cat "$tmpdir/header.md" "$tmpdir/table.md" > BENCHMARK.md
